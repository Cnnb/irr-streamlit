# -*- coding: utf-8 -*-
"""Untitled6.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1kv15L_SACPjzQg6IOg72kBXobU0ZnrVp
"""

import numpy as np
import streamlit as st
import matplotlib.pyplot as plt
from scipy.special import lambertw


# =========================
# –ú–û–î–ï–õ–¨ IRR
# =========================
def IRR(
    Mvn,        # –∫–∞–ø–∏—Ç–∞–ª—å–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è, —Ä—É–±
    Tvosst,     # —Å—Ä–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è, –ª–µ—Ç
    Msod,       # —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã, —Ä—É–±/–≥–æ–¥
    Cp,         # —Ü–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏, —Ä—É–±
    Kteh,       # —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
    Ktg,        # –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
    Tpl,        # –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –µ–¥/–≥–æ–¥
    Tvosstso,   # —Å—Ä–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –°–û, –ª–µ—Ç
    Y           # –≤—Ä–µ–º—è, –ª–µ—Ç
):
    A = (
        Msod * Tvosst
        - Cp * Kteh * Ktg * Tpl * Tvosst
        + Cp * Kteh * Ktg * Tpl * Tvosstso
    )

    W = lambertw(
        (A * Y / (Mvn * Tvosst)) * np.exp((A * Y) / (Mvn * Tvosst))
    )

    irr = (
        -Msod * Tvosst * Y
        + Cp * Kteh * Ktg * Tpl * Tvosst * Y
        - Cp * Kteh * Ktg * Tpl * Tvosstso * Y
        + Mvn * Tvosst * W.real
    ) / (Mvn * Tvosst * Y)

    return irr


# =========================
# –ù–ê–°–¢–†–û–ô–ö–ò –°–¢–†–ê–ù–ò–¶–´
# =========================
st.set_page_config(
    page_title="IRR –ø—Ä–æ–µ–∫—Ç–∞",
    layout="wide"
)

st.title("–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∞—Å—á—ë—Ç IRR –ø—Ä–æ–µ–∫—Ç–∞")


# =========================
# –ë–ê–ó–û–í–´–ô –°–¶–ï–ù–ê–†–ò–ô
# =========================
BASE = {
    "Mvn": 20_000_000,
    "Tvosstso": 2.0,
    "Kteh": 100,
    "Tpl": 5000,
    "Tvosst": 12,
    "Msod": 1_000_000,
    "Cp": 50_000,
    "Ktg": 0.1
}

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è session_state
for k, v in BASE.items():
    if k not in st.session_state:
        st.session_state[k] = v


# =========================
# SIDEBAR ‚Äî –ö–ù–û–ü–ö–ê –°–ë–†–û–°–ê
# =========================
st.sidebar.header("–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–º")

if st.sidebar.button("üîÑ –°–±—Ä–æ—Å –∫ –±–∞–∑–æ–≤–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é"):
    for k, v in BASE.items():
        st.session_state[k] = v


# =========================
# SIDEBAR ‚Äî –ü–ê–†–ê–ú–ï–¢–†–´
# =========================
st.sidebar.markdown("### –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã")

Mvn = st.sidebar.number_input(
    "–ö–∞–ø–∏—Ç–∞–ª—å–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è, —Ä—É–± (Mvn)",
    min_value=1_000_000,
    max_value=1_000_000_000,
    step=1_000_000,
    key="Mvn"
)

Tvosstso = st.sidebar.number_input(
    "–°—Ä–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –°–û, –ª–µ—Ç (Tvosstso)",
    min_value=0.5,
    max_value=10.0,
    step=0.5,
    key="Tvosstso"
)

st.sidebar.markdown("### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã")

Kteh = st.sidebar.slider(
    "Kteh ‚Äî —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç",
    20, 200, key="Kteh"
)

Tpl = st.sidebar.slider(
    "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –µ–¥/–≥–æ–¥",
    1000, 10000, step=10, key="Tpl"
)

Tvosst = st.sidebar.slider(
    "–°—Ä–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è, –ª–µ—Ç",
    6, 24, key="Tvosst"
)

Msod = st.sidebar.slider(
    "–≠–∫—Å–ø–ª. –∑–∞—Ç—Ä–∞—Ç—ã, —Ä—É–±/–≥–æ–¥",
    600_000, 1_800_000, step=100_000, key="Msod"
)

Cp = st.sidebar.slider(
    "–¶–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏, —Ä—É–±",
    1_000, 1_000_000, step=1_000, key="Cp"
)

Ktg = st.sidebar.slider(
    "–ö—Ç–≥ ‚Äî –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏",
    0.01, 0.2, step=0.01, key="Ktg"
)


# =========================
# –†–ê–°–ß–Å–¢
# =========================
Y = np.linspace(0.1, 10, 400)

irr = IRR(
    Mvn=Mvn,
    Tvosst=Tvosst,
    Msod=Msod,
    Cp=Cp,
    Kteh=Kteh,
    Ktg=Ktg,
    Tpl=Tpl,
    Tvosstso=Tvosstso,
    Y=Y
)

irr_5 = np.interp(5, Y, irr) * 100
irr_10 = np.interp(10, Y, irr) * 100


# =========================
# –í–´–í–û–î: KPI
# =========================
col1, col2, col3 = st.columns(3)

col1.metric("IRR –Ω–∞ 5-–º –≥–æ–¥—É", f"{irr_5:.2f} %")
col2.metric("IRR –Ω–∞ 10-–º –≥–æ–¥—É", f"{irr_10:.2f} %")
col3.metric("–ö–∞–ø–∏—Ç–∞–ª—å–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è", f"{Mvn/1_000_000:.1f} –º–ª–Ω —Ä—É–±")


# =========================
# –ì–†–ê–§–ò–ö
# =========================
fig, ax = plt.subplots()
ax.plot(Y, irr * 100)
ax.set_xlabel("–í—Ä–µ–º—è, –ª–µ—Ç")
ax.set_ylabel("IRR, %")
ax.grid(True)

st.pyplot(fig)


# =========================
# –¢–ï–ö–°–¢–û–í–û–ï –û–ü–ò–°–ê–ù–ò–ï –°–¶–ï–ù–ê–†–ò–Ø
# =========================
st.markdown("### –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è")

st.write(
    f"""
**–ö–∞–ø–∏—Ç–∞–ª—å–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è:** {Mvn:,.0f} —Ä—É–±
**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** {Tpl} –µ–¥/–≥–æ–¥
**–¶–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏:** {Cp:,.0f} —Ä—É–±
**–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã:** {Msod:,.0f} —Ä—É–±/–≥–æ–¥
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (Kteh):** {Kteh}
**–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (Ktg):** {Ktg:.2f}
**–°—Ä–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** {Tvosst} –ª–µ—Ç
**–°—Ä–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –°–û:** {Tvosstso} –ª–µ—Ç

üëâ –ü—Ä–∏ –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö **IRR –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–µ 10 –ª–µ—Ç —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {irr_10:.2f}%**.
"""
)